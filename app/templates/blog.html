{# blog.html
   =========

Blog for a user
#}
{% extends "main.html" %}

{% block extrahead %}
<link rel="alternate" type="application/rss+xml"
  title="RSS Feed for {{id}}" href="/rss/blog/{{id}}" />
{% endblock extrahead %}

{% block body %}
{{rowcol("md-8")}}
<h1><i class='fa fa-list-ul'></i> {{blogTitle}}</h1>

<div id="messages">
{{messages}}
</div>
{{col("md-4")}}
<h2>@{{user.getNameH()}}'s blog</h2>

<table class='bz-report-table'>
<tr>
    <th>posts</th>
    <th>head</th>
    <th>following</th>
    <th>followers</th>
</tr>
<tr>
    <td style='text-align:center;'>{{numPosts}}</td>
    <td style='text-align:center;'>{{numHeadPosts}}</td>
    <td style='text-align:center;'>{{numFollowing}}</td>
    <td style='text-align:center;'>{{numFollowers}}</td>
</tr>
</table>

{% if currentUserName()==id %}
<p><a class='btn btn-primary' href="/messRep">
<i class='fa fa-comment-o'></i> 
Write new message</a></p>
{% endif %}

<p>Name: {{name}}</p>

{{bio}}

{% if currentUserName()==id %}
<p><a class='btn btn-info' href="/accountSettings">
<i class='fa fa-cog'></i> 
Account Settings</a></p>
{% endif %}

<h2><i class='fa fa-sliders'></i> Formatting Options</h2>
<form id="formatingOptionForm" method=GET>
<input type="hidden" name="x" value="x">
{{fof.buildForm()}}
</form>

<h2>Subscription</h2>

<p><a class='btn btn-default' href="/rss/blog/{{id}}">
<i class='fa fa-rss'></i> RSS Feed</a></p>

{#---------- follow button ----------#}
{% if currentUserName() %}
<span id="followButton">
{% if followButton=='follow' %}
<button class='btn btn-success' onclick="follow(1)">
<i class='fa fa-check-circle'></i>
Follow @{{id}}
</button>
{% elif followButton=='unfollow' %}
<button class='btn btn-danger' onclick="follow(0)">
<i class='fa fa-times-circle'></i>
Unfollow @{{id}}
</button>
{% endif %}
</span>
{% endif %}

{{endrow()}}
{% endblock body %}

{%block atend%}
<script>
//--------------------------------------------------------------------
/* formatting options */

function foChanged(){
    /* fired when a Formatting Option has changed 
    Fire off the form as a GET request 
    */
    $("#formatingOptionForm").submit();
}    

$("#id_oneLine").change(foChanged);
$("#id_headOnly").change(foChanged);
$("#id_mrf").change(foChanged);
$("#id_au").change(foChanged);

//--------------------------------------------------------------------
/* follow button */

var id={{idJson}};

function follow(n){
    /* n=1 means follow, n=0 means unfollow */
    console.log
    var u = "/x/follow/" + id + "/" + n;
    $.ajax({
        url: u,
        method: "POST",
    }).done(function(){
        var h = ("<span class='btn btn-default'>"
            + (n==1 ? "Now following" : "Unfollowed")
            + " @" + id + "</span>");
        $("#followButton").html(h);
    });
}

//--------------------------------------------------------------------

</script>
{%endblock atend%}

{# end #}